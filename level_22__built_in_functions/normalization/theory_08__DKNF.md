## Доменно-ключевая нормальная форма (DKNF)

DKNF — это самая строгая форма нормализации базы данных. Она гарантирует, что все ограничения на данные в таблице могут быть выражены исключительно через ограничения на домены (домен — это множество допустимых значений для атрибута) и ключи.

Простой способ объяснить DKNF — это таблица, в которой не осталось ни одной аномалии данных (ни одной функциональной, ни транзитивной зависимости), и все ограничения на данные контролируются исключительно с помощью доменных и ключевых ограничений, без необходимости вводить дополнительные функциональные зависимости.
Характеристика DKNF:

    Каждая таблица в DKNF должна быть такой, что все ограничения на данные могут быть выражены в виде ограничений на домены значений атрибутов и ключей.
    Все функциональные зависимости должны быть "сущностными" (относящимися к ограничениям значений), а не "произвольными" (определяемыми избыточными зависимостями).
    В отличие от BCNF или 3NF, в DKNF не существует транзитивных зависимостей, и любые данные можно выразить с помощью атрибутов или их значений.

Условия для удовлетворения DKNF:

    Все функциональные зависимости являются зависимостями на ключи: То есть, для каждой функциональной зависимости X→Y, X должен быть суперключом.
    Отсутствие сложных зависимостей: Каждая зависимость должна быть явной и строго ограниченной доменом значений.

Пример таблицы, нарушающей DKNF:

Возьмем пример с таблицей студентов и курсов:

| StudentID | CourseID | InstructorName | Grade |
|-----------|----------|----------------|-------|
| 1         | 101      | Dr. Smith      | A     |
| 1         | 102      | Dr. Johnson    | B     |
| 2         | 101      | Dr. Smith      | A     |
| 2         | 103      | Dr. Brown      | C     |

Нарушение DKNF:

    В этой таблице существует зависимость CourseID → InstructorName. То есть, для каждого CourseID однозначно определяется InstructorName.
    Эта зависимость нарушает DKNF, потому что CourseID не является потенциальным ключом. Например, CourseID не может быть уникальным идентификатором для каждой строки таблицы, поскольку курс может преподаваться нескольким студентам. Таким образом, зависимость CourseID → InstructorName не может быть выражена через ограничения на домены и ключи, что нарушает принцип DKNF.

Приведение таблицы в DKNF:

Чтобы привести таблицу к DKNF, нам нужно исключить все такие функциональные зависимости, которые не могут быть выражены через доменные ограничения. Разделим таблицу на две:
Таблица 1: Курсы и преподаватели

| CourseID | InstructorName |
|----------|----------------|
| 101      | Dr. Smith      |
| 102      | Dr. Johnson    |
| 103      | Dr. Brown      |

Здесь CourseID является ключом, и зависимость CourseID → InstructorName теперь не нарушает DKNF, так как она выражена через ключ (и это единственная зависимость, которую можно выразить на уровне домена).
Таблица 2: Студенты и курсы с оценками

| StudentID | CourseID | Grade |
|-----------|----------|-------|
| 1         | 101      | A     |
| 1         | 102      | B     |
| 2         | 101      | A     |
| 2         | 103      | C     |

Здесь StudentID и CourseID вместе составляют ключ, и эта таблица также соответствует DKNF, так как нет других зависимостей между атрибутами, кроме как через ключи.
Почему теперь таблицы удовлетворяют DKNF?

    Первое ограничение: Все зависимости теперь выражены через ключи.
    Второе ограничение: Все значения в таблице ограничены доменом (например, Grade ограничено набором возможных оценок, InstructorName ограничено возможными именами преподавателей).
    Нет лишних зависимостей: Например, зависимость CourseID → InstructorName теперь находится в отдельной таблице, где CourseID является ключом, и эта зависимость контролируется доменом.

Преимущества и сложности DKNF:

    Преимущество: DKNF устраняет все возможные аномалии вставки, обновления и удаления данных, так как каждая зависимость выражена через ключ или домен.
    Сложности: В реальных системах создание и поддержание таблиц, удовлетворяющих DKNF, может быть сложным. Это связано с тем, что в большинстве случаев для практических задач достаточно 3NF или BCNF, а DKNF требует более сложной архитектуры базы данных.

Итог:

DKNF — это строгая форма нормализации, которая гарантирует отсутствие всех видов функциональных зависимостей, которые не могут быть выражены через доменные и ключевые ограничения. Для этого часто приходится сильно "разбиение" таблиц, что повышает сложность, но устраняет любые аномалии данных.