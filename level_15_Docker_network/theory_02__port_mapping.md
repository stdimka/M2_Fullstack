# Публикация портов контейнеров

## 1. Внутренние и внешние порты

Каждое приложение внутри Docker-контейнера работает в своём изолированном сетевом пространстве. Чтобы получить доступ к приложению извне (например, через браузер), нужно указать:

- **внутренний порт** — это порт, на котором приложение слушает внутри контейнера (например, 80 для Nginx или Apache);

- **внешний порт** — это порт на хост-машине (вашем сервере или локальном компьютере), на который будет направлен трафик.

Пример:
```
docker run -d -p 8080:80 nginx
```
- Контейнер запускается с образом nginx.
- Nginx по умолчанию слушает порт 80 внутри контейнера.
- Порт 8080 на хосте проброшен внутрь контейнера, поэтому при обращении к http://localhost:8080 вы фактически попадаете на http://<container>:80.

## 2. Синтаксис команды -p

Формат:
```
-p [host_port]:[container_port]
```
Примеры:
```
docker run -p 3000:80 myapp
```
- В контейнере приложение слушает порт 80.
- Снаружи к нему можно обратиться через localhost:3000.

Также можно указать, на каком IP-адресе хоста будет доступен порт:
```
-p 127.0.0.1:8080:80
```
- Контейнер будет доступен только локально, с хоста.
- Если IP не указан (например, -p 8080:80), порт будет слушаться на всех интерфейсах (0.0.0.0), то есть будет доступен из сети.
- 
## 3. Автоматическое сопоставление порта

Если указать только порт контейнера:
```
docker run -p 80 myapp
```
Docker сам выберет свободный случайный порт на хосте и свяжет его с портом 80 контейнера.

Чтобы узнать, какой порт был выбран, используйте:
```
docker ps
```
Вывод будет содержать строку в колонке PORTS, например:
```
0.0.0.0:49153->80/tcp
```

Это означает, что `localhost:49153` направляется на 80 внутри контейнера.

## 4. Множественный проброс

Вы можете пробросить несколько портов, если контейнер использует больше одного (например, HTTP и HTTPS):
```
docker run -p 8080:80 -p 8443:443 myapp
```
- 8080 на хосте будет направлен на 80 в контейнере (HTTP);
- 8443 — на 443 (HTTPS).

Это удобно, если вы хотите использовать нестандартные порты на хосте или избежать конфликта с другими службами.


## 5. EXPOSE в Dockerfile (не публикует порты!)

В Dockerfile можно указать:
```
EXPOSE 80
```
Это не публикует порт, а декларирует, что контейнер ожидает работу на этом порту. Это нужно, например:
- для документации (чтобы другой разработчик знал, какой порт использовать);
- для взаимодействия с инструментами вроде docker network;
- в docker-compose, чтобы упростить конфигурацию.

Однако без флага -p этот порт не будет доступен снаружи.

## 6. Docker Compose

В файле `docker-compose.yml` используется секция ports, чтобы пробросить порты так же, как с флагом -p в CLI:
```
services:
    web:
        image: nginx
        ports:
            - "8080:80"
```
Это:
- публикует порт 80 контейнера на 8080 хоста;
- аналогично docker run -p 8080:80.

Можно также указать IP:
```
ports:
    - "127.0.0.1:8080:80"
```