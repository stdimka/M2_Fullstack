# Постановка задачи

Допустим, у вас есть приложение, которое состоит из нескольких частей:

- **Backend** — сервер на Python.
- **Frontend** — сайт на React.
- **База данных** — MySQL.

На локальном компьютере вы запускаете их с помощью **Docker Compose** — всё работает отлично. Но потом вы хотите:

- Развернуть приложение **на нескольких серверах** (например, в продакшене).
- Обеспечить **отказоустойчивость**: если один сервер упадёт, приложение должно продолжить работать на других.
- Легко **масштабировать** приложение: добавлять новые серверы и контейнеры без простоев.

Тогда одной машины с одним **Docker Daemon** и обычным **Compose** уже недостаточно.

**Нужен кластер контейнеров**, который будет уметь:
- Автоматически управлять контейнерами на разных серверах.
- Следить за их состоянием.
- Перезапускать, перемещать контейнеры при сбоях.

Это и есть задача **оркестрации контейнеров**.

---

# Важные термины

| Термин          | Пояснение |
|:----------------|:----------|
| **Кластер**     | Набор физических или виртуальных серверов, объединённых в единую систему для выполнения задач. В нашем случае — для работы контейнеров. |
| **Оркестрация** | Автоматическое управление контейнерами: их развертывание, масштабирование, перезапуск при сбоях и балансировка нагрузки. |
| **Docker Daemon** | Фоновый процесс (`dockerd`), который запускает контейнеры на конкретной машине. |
| **Docker Compose** | Утилита для запуска нескольких контейнеров на **одной машине** на основе описания в `docker-compose.yml`. |

---

# Почему нельзя использовать один Docker Daemon и Compose?

| Причина | Объяснение |
|:--------|:-----------|
| Нет распределения нагрузки | Compose работает только на одной машине. Нельзя раскидать контейнеры на несколько серверов. |
| Нет отказоустойчивости | Если сервер упадет, всё приложение падает вместе с ним. |
| Нет самовосстановления | Compose не умеет сам перезапускать контейнеры на другом сервере. |
| Нет централизованного управления | Каждая машина с Docker Compose требует ручного управления. |
| Нет масштабирования на уровне кластера | Нельзя автоматически добавлять новые машины и увеличивать число контейнеров. |

**Вывод:**  
Docker Compose — отличное решение для локальной разработки или небольших проектов на одном сервере. Для масштабируемых систем нужен **оркестратор**, например **Docker Swarm**.

---

# Основные компоненты Docker Swarm

Теперь посмотрим, **как устроен Docker Swarm**:

| Компонент          | Пояснение |
|:-------------------|:----------|
| **Node (Узел)** | Сервер, который входит в кластер. Может быть физическим или виртуальным. Каждый `node` управляется Docker Daemon-ом. |
| **Manager Node** | Узел, который управляет кластером: принимает решения о размещении контейнеров, отслеживает состояние кластера. Их обычно несколько для отказоустойчивости. |
| **Worker Node** | Узел, который исполняет задания (запускает контейнеры), полученные от Manager'ов. Сам ничего не решает. |
| **Service** | Описание задачи для кластера: какой контейнер нужно запустить, в каком количестве экземпляров. |
| **Task** | Конкретное задание на запуск одного экземпляра контейнера. Менеджер отдаёт воркеру задачу, и воркер запускает контейнер. |
| **Swarm** | Сам кластер: объединение всех нод в единую систему управления контейнерами. |
| **Overlay Network** | Виртуальная сеть, которая соединяет контейнеры на разных машинах, будто бы они находятся в одной локальной сети. |

---

# Краткая схема процесса

1. Вы инициируете кластер: `docker swarm init`.
2. Переводите другие машины в кластер: `docker swarm join`.
3. Создаёте сервис: `docker service create`.
4. Swarm сам решает:
   - На каком узле запустить контейнер.
   - Как перенести контейнер при сбое.
   - Как распределить нагрузку.
5. Вы масштабируете приложение командой: `docker service scale`.

---

# Простое сравнение

| Технология | Где работает | Масштабирование | Отказоустойчивость |
|:-----------|:--------------|:----------------|:-------------------|
| Docker Compose | Одна машина | Ручное | Нет |
| Docker Swarm | Кластер из машин | Автоматическое | Да |

---
