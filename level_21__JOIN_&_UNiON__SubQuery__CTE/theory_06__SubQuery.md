# –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã (SubQuery) –≤ MySQL:

**–ü–æ–¥–∑–∞–ø—Ä–æ—Å** ‚Äî —ç—Ç–æ SQL-–∑–∞–ø—Ä–æ—Å, –≤–ª–æ–∂–µ–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä—å –¥—Ä—É–≥–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞. 

–û–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ `SELECT`, `INSERT`, `UPDATE` –∏–ª–∏ `DELETE`, –∞ —Ç–∞–∫–∂–µ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö `WHERE`, `FROM` –∏ `HAVING`.

–ü—Ä–∏–º–µ—Ä –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞:
```
SELECT name
FROM employees
WHERE department_id = (
    SELECT id
    FROM departments
    WHERE name = 'Sales'
);
```
–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏—Ç id –æ—Ç–¥–µ–ª–∞ `Sales`, –∞ –∑–∞—Ç–µ–º –≤–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å –∏—â–µ—Ç –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —ç—Ç–æ–≥–æ –æ—Ç–¥–µ–ª–∞.

## –ì–¥–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã (SubQuery)?

| –ú–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | –ü—Ä–∏–º–µ—Ä                                                                                                                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| SELECT              | `SELECT name, salary, (SELECT AVG(salary) FROM employes) AS avg_salary FROM employees;`                                                                                    | –ü–æ–¥–∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∫–∞–ª—è—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ª–µ –≤ SELECT. |
| FROM                | `SELECT * FROM (SELECT * FROM orders WHERE amount > 100) AS t_big_orders;`                                                                                                 | –ü–æ–¥–∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Å–µ–≤–¥–æ–Ω–∏–º. |
| WHERE               | `SELECT name, salary FROM employes WHERE employes > (SELECT AVG(salary) FROM employes);`                                                                                          | –ü–æ–¥–∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä ‚Äî –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π. |
| HAVING              | `SELECT customer_id, COUNT(*) FROM orders GROUP BY customer_id HAVING COUNT(*) > (SELECT AVG(cnt) FROM (SELECT COUNT(*) AS cnt FROM orders GROUP BY customer_id) AS sub);` | –ü–æ–¥–∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. |


## üì¶ –ì—Ä–∞–¥–∞—Ü–∏—è –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

| –¢–∏–ø –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞        | –û–ø–∏—Å–∞–Ω–∏–µ                                             | –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è               |
|------------------------|------------------------------------------------------|-------------------------------|
| –°–∫–∞–ª—è—Ä–Ω—ã–π              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ                             | `SELECT`, `WHERE`, `HAVING`   |
| –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π        | –û–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü (–º–∞—Å—Å–∏–≤)                                | `IN`, `NOT IN`                |
| –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è | –ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ —Å—Ç—Ä–æ–∫, —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –∫–æ—Ä—Ç–µ–∂–∏ | `WHERE (col1, col2) IN (...)` |
| –¢–∞–±–ª–∏—á–Ω—ã–π              | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–∞—è      | `FROM`, `JOIN`, `WITH`        |

### –ü—Ä–∏–º–µ—Ä—ã 
#### üü© –°–∫–∞–ª—è—Ä–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å
```
SELECT name
FROM customers
WHERE id = (
    SELECT MIN(id)
    FROM customers
);
```

#### üü¶ –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π
```
SELECT name
FROM customers
WHERE id IN (
    SELECT customer_id
    FROM orders
);
```

#### üü® –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```
SELECT *
FROM employees
WHERE (department_id, job_title) IN (
    SELECT dept_id, title
    FROM department_roles
);
```

#### üü™ –¢–∞–±–ª–∏—á–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å
```
SELECT d.name, COUNT(*) AS employee_count
FROM (
    SELECT * FROM employees
    WHERE hired_date >= '2020-01-01'
) AS recent_hires
JOIN departments d ON recent_hires.department_id = d.id
GROUP BY d.name;
```

## ‚úÖ –ü–ª—é—Å—ã –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤

| –ü–ª—é—Å                 | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|----------------------|------------|
| –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å           | –£–ø—Ä–æ—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ. |
| –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è         | –ò–∑–æ–ª–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —á–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏ –≤ –≤–∏–¥–µ "—á—ë—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞". |
| –ì–∏–±–∫–æ—Å—Ç—å             | –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é. |
| –ë–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü | –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã. |

## ‚ùå –ú–∏–Ω—É—Å—ã –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤

| –ú–∏–Ω—É—Å                        | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|-----------------------------|------------|
| –ú–µ–¥–ª–µ–Ω–Ω–µ–µ JOIN              | –ß–∞—Å—Ç–æ `JOIN` —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤. |
| –ö–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã | –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî —ç—Ç–æ –¥–æ—Ä–æ–≥–æ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º. |
| –ü–ª–æ—Ö–æ —á–∏—Ç–∞–µ–º—ã–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ | –°–ª–æ–∂–Ω—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã —Ç—Ä—É–¥–Ω—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è. |
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MySQL           | –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö MySQL –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö). |

