# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–π –∏ –º—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂ —Å–±–æ—Ä–∫–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ - —Ç—Ä–µ–±—É–µ—Ç—Å—è, –∫–∞–∫ –º–∏–Ω–∏–º—É–º, –¥–≤–µ —Å—Ç–∞–¥–∏–∏.

## üö® –ü–æ—á–µ–º—É –æ–¥–Ω–æ—Å—Ç–∞–¥–∏–π–Ω—ã–π –æ–±—Ä–∞–∑ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ç—è–∂–µ–ª–µ–µ –∏ "–≥—Ä—è–∑–Ω–µ–µ"?
+ –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å pip, –Ω–µ —É–¥–∞–ª—è—è –≤—Å—ë
  - –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `pip`, –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –æ–±—Ä–∞–∑–µ.
  - –£–¥–∞–ª–∏—Ç—å –µ–≥–æ –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ, –Ω–æ —Å–ª–æ–∂–Ω–æ –∏ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ (–º–æ–≥—É—Ç —ç–∞–æ–¥–Ω–æ —É–¥–∞–ª–∏—Ç—å—Å—è –∏ –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏).
  - –û–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–∏—à–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã, —Å–ª–æ–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`setuptools`, `wheel` –∏ –¥—Ä.).

+ –°–ª–æ–∏ Docker'–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –≤—Å—ë
  - –ö–∞–∂–¥–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `RUN`, `COPY`, `ADD` —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Å–ª–æ–π
  - –î–∞–∂–µ –µ—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø–æ–∑–∂–µ, –æ–Ω –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å–ª–æ—ë–≤ –æ–±—Ä–∞–∑–∞.
  - –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–∞–Ω–¥–∞ `RUN pip install flask && rm -rf ~/.cache` –Ω–µ —É–¥–∞–ª–∏—Ç –≤–µ—Å—å –∫—ç—à –∏–∑ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ ‚Äî –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –Ω–æ–≤—ã–π —Å–ª–æ–π.

+ –ù–µ—Ç –∏–∑–æ–ª—è—Ü–∏–∏ "—Å—Ä–µ–¥—ã —Å–±–æ—Ä–∫–∏"
  - –í –æ–¥–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Å–º–µ—à–∏–≤–∞—Ç—å —ç—Ç–∞–ø—ã —Å–±–æ—Ä–∫–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.
  - –≠—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –º–µ—à–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é –∏ —Å–Ω–∏–∂–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

## –ß—Ç–æ –¥–µ–ª–∞–µ–º?
–î–≤–∞–∂–¥—ã —Å–æ–∑–¥–∞–¥–∏–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø—Ä–æ–µ–∫—Ç:
 - —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–π —Å—Ç–∞–¥–∏–∏
 - –∏ —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö

## –°—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
Python-–∫–æ–¥ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ Flask ‚Äî –æ–Ω –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å "Hello from Docker!" –ø–æ HTTP.

–ú—ã –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–µ–º –¥–≤–∞ Dockerfile:
- –û–±—ã—á–Ω—ã–π (–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π) ‚Äî —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
- –ú—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂ ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –±–µ–∑ Python-–ø–∞–∫–µ—Ç–æ–≤, —Ç–æ–ª—å–∫–æ —Å –Ω—É–∂–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏.

–ò —Å—Ä–∞–≤–Ω–∏–º —Ä–∞–∑–º–µ—Ä—ã –æ–±—Ä–∞–∑–æ–≤.

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
flask-examples/
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile        # –æ–±—ã—á–Ω–∞—è —Å–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ Dockerfile.multi  # –º—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂-—Å–±–æ—Ä–∫–∞
```
üìÑ app.py
```
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello from Docker!"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```
üìÑ requirements.txt
```
flask
```
## üì¶ –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—ã—á–Ω—ã–π Dockerfile

```
# –æ–±—ã—á–Ω—ã–π –æ–±—Ä–∞–∑: Python + –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ + –∫–æ–¥
FROM python:3.12-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 5000
CMD ["python", "app.py"]
```

## ü™Ñ –í–∞—Ä–∏–∞–Ω—Ç 2: –ú—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂ Dockerfile.multi
```
# –≠—Ç–∞–ø 1: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∞
FROM python:3.12-slim AS builder

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir --target=/deps -r requirements.txt

COPY app.py .

# –≠—Ç–∞–ø 2: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
FROM python:3.12-slim

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–¥
COPY --from=builder /deps /usr/local/lib/python3.12/site-packages
COPY --from=builder /app/app.py .

EXPOSE 5000
CMD ["python", "app.py"]
```
‚úÖ –î–µ–ª–∞–µ—Ç –ø–æ—á—Ç–∏ —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –æ–±—Ä–∞–∑–µ:

- –Ω–µ—Ç `pip`,
- –Ω–µ—Ç `requirements.txt`,
- –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫—ç—à–µ–π,
- –º–µ–Ω—å—à–µ —Å–ª–æ—ë–≤.

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤–æ –≤—Ç–æ—Ä–æ–π Dockerfile?

### ‚úÖ AS builder
```
FROM python:3.12-slim AS builder
```
üîπ –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —ç—Ç–∞–ø —Å–±–æ—Ä–∫–∏ ‚Äî –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Å –∏–º–µ–Ω–µ–º builder.

üì¶ –ó–∞—á–µ–º?
–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã:
- –º–æ–∂–Ω–æ –±—ã–ª–æ –∫ –Ω–µ–º—É –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ `COPY --from=builder ...`
- –í–Ω—É—Ç—Ä–∏ `builder` –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (`pip`, `build`, –∏ —Ç.–¥.), –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑.

üìù –ú–æ–∂–Ω–æ –∏–º–µ—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ç–∞–∫–∏—Ö —ç—Ç–∞–ø–æ–≤: `AS builder`, `AS dev`, `AS test`, `AS runtime`, –∏ —Ç.–ø.
### ‚úÖ `--target=/deps –≤ pip install`
```
RUN pip install --no-cache-dir --target=/deps -r requirements.txt
```
–§–ª–∞–≥ `--target=/deps` –≥–æ–≤–æ—Ä–∏—Ç `pip install`, —á—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –Ω–µ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π Python, –∞ –ø–∞–ø–∫—É `/deps`

üì¶ –ó–∞—á–µ–º?

- –ß—Ç–æ–±—ã –ø–æ—Ç–æ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —ç—É—Ç –ø–∞–ø–∫—É –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑.
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å `/usr/local/lib/...` –≤ builder-–æ–±—Ä–∞–∑–µ –∏ —É–¥–æ–±–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—É—Ç—è–º–∏.

–í –∏—Ç–æ–≥–µ, –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π —Å—Ç–∞–¥–∏–∏ —Å–±–æ—Ä–∫–∏, –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `builder` –ø–æ—è–≤–∏—Ç—Å—è —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
```
/deps/
‚îî‚îÄ‚îÄ flask/
‚îî‚îÄ‚îÄ flask-2.3.3.dist-info/
```
### ‚úÖ COPY `--from=builder /deps /usr/local/lib/python3.12/site-packages`
```
COPY --from=builder /deps /usr/local/lib/python3.12/site-packages
```
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É `/deps` –∏–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ `builder` –≤ —Ü–µ–ª–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `site-packages` –≤–Ω—É—Ç—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

üì¶ –ó–∞—á–µ–º?
- `site-packages` ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–µ—Å—Ç–æ, –æ—Ç–∫—É–¥–∞ Python –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è Flask –∏ –ø—Ä–æ—á–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±—É–¥—É—Ç ¬´–≤–∏–¥–Ω—ã¬ª –¥–ª—è Python, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–∏ –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ pip

### ‚úÖ `COPY --from=builder /app.py .`
```
COPY --from=builder /app.py .
```
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∞–π–ª `app.py` –∏–∑ builder-—ç—Ç–∞–ø–∞ –≤ —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (`/app`) —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

üì¶ –ó–∞—á–µ–º?
- –í –∏—Ç–æ–≥–æ–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ –±—É–¥–µ—Ç –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ `app.py`.
- –ê –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `flask-examples` (`Dockerfile` –∏ —Ç.–¥.) –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–∞–¥–∏–∏ —Å–±–æ—Ä–∫–∏ –∏ –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ –Ω—É–∂–Ω—ã –≤ production.
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –Ω–∏ `requirements.txt`, –Ω–∏ `.git`, –Ω–∏ –¥—Ä—É–≥–∏–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏

üîö –ü–æ–¥—ã—Ç–æ–∂–∏–º:

| –°—Ç—Ä–æ–∫–∞                             | –ó–Ω–∞—á–µ–Ω–∏–µ                                                             |
|-----------------------------------|----------------------------------------------------------------------|
| `AS builder`                      | –°–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –æ–±—Ä–∞–∑ —Å –∏–º–µ–Ω–µ–º `builder`                      |
| `--target=/deps`                  | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/deps`            |
| `COPY --from=builder /deps ...`   | –ö–æ–ø–∏—Ä—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ `builder` –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑                  |
| `COPY --from=builder /app.py .`   | –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π —Ñ–∞–π–ª `app.py`, –∏–∑–±–µ–≥–∞—è –≤—Å–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ         |


## –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–í–ù–ò–ú–ê–ù–ò–ï: —Ç–µ—Ä–º–∏–Ω–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞!
```
# –æ–±—ã—á–Ω—ã–π
docker build -t flask-regular -f Dockerfile .
docker run -d --name regular-container -p 5000:5000 flask-regular

# –º—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂
docker build -t flask-multy-stage -f Dockerfile.multi .
docker run -d --name multy-stage-container -p 5001:5000 flask-multy-stage

# –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–±–æ–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
curl http://localhost:5000
curl http://localhost:5001

# –≤—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—Ä–∞–∑–∞—Ö, —á—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏—Ç—å –∏—Ö —Ä–∞–∑–º–µ—Ä—ã
docker images
```
–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:
```
REPOSITORY          TAG       IMAGE ID       CREATED          SIZE
flask-multy-stage   latest    195bfb796ba0   3 minutes ago    129MB
flask-regular       latest    4c568cbe6411   20 minutes ago   1.03GB
```

–ö–∞–∫ –≤–∏–¥–∏–º, 129MB –ø—Ä–æ—Ç–∏–≤ 1.03GB - –≤—ã–∏–≥—Ä—ã—à –æ—á–µ–≤–∏–¥–µ–Ω!