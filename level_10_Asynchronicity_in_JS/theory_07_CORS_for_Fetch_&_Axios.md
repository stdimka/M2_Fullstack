# Что такое CORS?

**CORS (Cross-Origin Resource Sharing)** — это механизм безопасности в веб-браузерах, который позволяет или ограничивает доступ к ресурсам на одном веб-сайте с другого. Он предназначен для защиты от вредоносных запросов, которые могут быть выполнены в контексте других доменов. Например, если веб-страница на домене example.com пытается получить данные с API на anotherdomain.com, браузер будет проверять, разрешено ли это с помощью CORS.

Основная идея заключается в том, что браузеры блокируют кросс-доменные запросы по умолчанию, если сервер не указывает явное разрешение.

## Как работает CORS?

### Простой запрос (Simple Request):

Это запросы с методами GET, POST и HEAD, с определёнными заголовками, которые считаются безопасными.
Если сервер поддерживает CORS, он может отправить соответствующий заголовок `Access-Control-Allow-Origin`,
разрешая доступ из конкретных источников.

### Предварительный запрос (Preflight Request):

Если запрос не является простым (например, использует методы PUT, DELETE, или нестандартные заголовки),
браузер сначала отправляет запрос OPTIONS на сервер, чтобы узнать, разрешает ли он такие запросы.
Это называется `preflight`.

### Ответ сервера:

Сервер может ответить с заголовками:
- `Access-Control-Allow-Origin`: 
  - Указывает, какие домены могут получать доступ к ресурсу.

- `Access-Control-Allow-Methods`: 
  - Перечисляет методы, которые разрешены для доступа.

- `Access-Control-Allow-Headers`: 
  - Указывает, какие заголовки могут быть использованы при запросе.

## CORS в контексте fetch и axios

### Fetch

    В fetch CORS обрабатывается автоматически. При выполнении кросс-доменных запросов браузер будет проверять заголовки ответа, чтобы убедиться, что сервер разрешает доступ. Если сервер не настроен на разрешение запросов из вашего домена, запрос будет заблокирован.

#### Пример с fetch:
```
fetch('https://httpbin.org/get', {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    },
    mode: 'cors'  // Обратите внимание на 'cors'
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.log('Error:', error));
```

В этом примере mode: 'cors' указывает, что запрос будет выполнен с включенной поддержкой CORS. Это означает, что браузер будет следить за тем, чтобы сервер httpbin.org позволял доступ с другого домена. Ответ будет содержать необходимые CORS-заголовки.

### Axios:
В axios кросс-доменные запросы обрабатываются аналогично, но с дополнительными опциями для более гибкого контроля. Например, можно задать `withCredentials`, если необходимо отправлять куки с запросом.

#### Пример с axios:
```
axios.get('https://httpbin.org/get')
    .then(response => {
        console.log(response.data);
    })
    .catch(error => {
        console.error('Error:', error);
    });
```

В axios запрос будет отправлен по умолчанию с использованием режима CORS, если запрос идет на другой домен. Однако, если вы хотите использовать куки или авторизационные заголовки, вы можете использовать опцию `withCredentials`.
```
axios.get('https://httpbin.org/get', { withCredentials: true })
    .then(response => console.log(response.data))
    .catch(error => console.error(error));
```

## Основные проблемы с CORS

- Отсутствие заголовков на сервере:
    - Если сервер не отправляет заголовки CORS в ответе, браузер заблокирует кросс-доменные запросы. Это часто бывает на стороне API, когда сервер не настроен для разрешения запросов с других доменов.

- Некорректно настроенные разрешения:
    - Например, если сервер разрешает только определённые методы или заголовки, и  запрос не соответствует этим условиям, то браузер заблокирует запрос.
    - 
- Типы запросов:
    - Для некоторых методов или заголовков может быть нужен предварительный запрос (OPTIONS). Если сервер не обрабатывает такие запросы корректно, это также приведёт к ошибкам.