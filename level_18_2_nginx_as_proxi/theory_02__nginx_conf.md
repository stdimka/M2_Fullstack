# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `nginx.conf` –Ω—É–∂–µ–Ω –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã.  
–í –Ω—ë–º –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å:

- –Ω–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É —Å–ª—É—à–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 80 –¥–ª—è HTTP),
- –∫–∞–∫–∏–µ –¥–æ–º–µ–Ω—ã (–∏–ª–∏ –∏–º–µ–Ω–∞ —Ö–æ—Å—Ç–æ–≤) –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å,
- –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ URL-–ø—É—Ç–∏,
- –∫—É–¥–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è backend),
- –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç. –¥.).

–û–±—ã—á–Ω–æ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `/etc/nginx/nginx.conf`

–í –≥–æ—Ç–æ–≤—ã—Ö docker-–æ–±—Ä–∞–∑–∞—Ö —ç—Ç–æ—Ç —Ñ–∞–π–ª —É–∂–µ –∏–º–µ–µ—Ç—Å—è –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–∞–π—Ç–∞–º–∏.  
–ù–∞–ø—Ä–∏–º–µ—Ä:
```
user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    keepalive_timeout  65;

    include /etc/nginx/conf.d/*.conf;
}

```
### üîç –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –±–∞–∑–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
#### 1. –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```
user  nginx;
```

    –£–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å nginx.

    –û–±—ã—á–Ω–æ –≤ Docker-–æ–±—Ä–∞–∑–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å nginx —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏.

```
worker_processes  auto;
```

    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

    `auto` –æ–∑–Ω–∞—á–∞–µ—Ç: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Å–∫–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω–æ CPU-—è–¥–µ—Ä ‚Äî –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–Ω–µ –º–µ–Ω–µ–µ 512)

#### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ PID
```
error_log  /var/log/nginx/error.log warn;
```

    –ü—É—Ç—å –∫ –ª–æ–≥-—Ñ–∞–π–ª—É –æ—à–∏–±–æ–∫.

    –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî warn (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –≤—ã—à–µ).
```
pid        /var/run/nginx.pid;
```

    PID-—Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥–ª–∞–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ Nginx (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ç. –¥.).

#### 3. –°–µ–∫—Ü–∏—è events
```
events {
    worker_connections  1024;
}
```

    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

    worker_connections 1024; ‚Äî –∫–∞–∂–¥—ã–π worker –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–æ 1024 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

    –í–∞–∂–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.

#### 4. –°–µ–∫—Ü–∏—è http ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
```
http {
    ...
}
```

MIME-—Ç–∏–ø—ã –∏ —Ç–∏–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```
include       /etc/nginx/mime.types;
default_type  application/octet-stream;
```
    mime.types —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏–º Content-Type.

    default_type ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ.

–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
```
log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';
```
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —à–∞–±–ª–æ–Ω –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

    –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:

        IP –∫–ª–∏–µ–Ω—Ç–∞

        –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞

        –º–µ—Ç–æ–¥ + –ø—É—Ç—å + –ø—Ä–æ—Ç–æ–∫–æ–ª (GET / HTTP/1.1)

        HTTP-—Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞

        –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–π—Ç

        –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª (Referer)

        –±—Ä–∞—É–∑–µ—Ä (User-Agent)

        —Ü–µ–ø–æ—á–∫–∞ IP (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏)
```
access_log  /var/log/nginx/access.log  main;
```

    –í–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–∞–π–ª access.log —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–æ—Ä–º–∞—Ç–∞ main.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```
sendfile on;
```
    –í–∫–ª—é—á–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ —è–¥—Ä–æ (—É—Å–∫–æ—Ä—è–µ—Ç –æ—Ç–¥–∞—á—É –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤).
```
keepalive_timeout  65;
```
    –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç –¥–ª—è keep-alive-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 65 —Å–µ–∫—É–Ω–¥).

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
```
include /etc/nginx/conf.d/*.conf;
```
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ –ø–∞–ø–∫–∏ /etc/nginx/conf.d/.

    –û–±—ã—á–Ω–æ —Ç—É–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç —Å–∞–π—Ç—ã –≤ –≤–∏–¥–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:

        `/etc/nginx/conf.d/default.conf`

        `/etc/nginx/conf.d/app.conf`

–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º, –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –Ω–µ —Ç—Ä–æ–≥–∞—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª `nginx.conf`.  
–ß—Ç–æ –º—ã, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, –∏ —Å–¥–µ–ª–∞–ª–∏.



### –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `nginx.conf`
```
server {
    listen 80;
    server_name localhost;

    location ... {
        ...
    }
}
```
–≥–¥–µ

    `server` ‚Äî –±–ª–æ–∫, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–¥–Ω–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞.

    `listen 80;` ‚Äî —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ 80-–º –ø–æ—Ä—Ç—É (–æ–±—ã—á–Ω—ã–π –ø–æ—Ä—Ç –¥–ª—è HTTP).

    `server_name localhost`; ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è. –ó–¥–µ—Å—å ‚Äî localhost.

### –ë–ª–æ–∫ 1: –ü—Ä–æ–∫—Å–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```
location / {
    proxy_pass http://app:5000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```
–≥–¥–µ

    `location /` ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –∫–æ—Ä–Ω—é —Å–∞–π—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://localhost/`).

    `proxy_pass http://app:5000;` ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Flask –∏–ª–∏ FastAPI), –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ø–æ –∞–¥—Ä–µ—Å—É http://app:5000. –ó–¥–µ—Å—å app ‚Äî —ç—Ç–æ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker).

    `proxy_set_header Host $host;` ‚Äî –ø–µ—Ä–µ–¥–∞—ë—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, localhost) –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ.

    `proxy_set_header X-Real-IP $remote_addr;` ‚Äî –ø–µ—Ä–µ–¥–∞—ë—Ç —Ä–µ–∞–ª—å–Ω—ã–π IP –∫–ª–∏–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–Ω–∞–ª–æ, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å.

### –ë–ª–æ–∫ 2: –ü–∞–ø–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
```
location /images/ {
    alias /images/;
    autoindex on;
    access_log /var/log/nginx/images.log;
}
```
–≥–¥–µ

    `location /images/` ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ –ø—É—Ç–∏, –Ω–∞—á–∏–Ω–∞—é—â–µ–º—É—Å—è —Å /images/.

    `alias /images/;` ‚Äî –≥–æ–≤–æ—Ä–∏—Ç nginx –∏—Å–∫–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /images/ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

        –ù–∞–ø—Ä–∏–º–µ—Ä, `http://localhost/images/cat.jpg ‚Üí /images/cat.jpg`.

    `autoindex on;` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω —Ñ–∞–π–ª).

    `access_log /var/log/nginx/images.log;` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —ç—Ç–æ–π –ø–∞–ø–∫–µ –æ—Ç–¥–µ–ª—å–Ω–æ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).

### –ë–ª–æ–∫ 3: –°—Ç–∞—Ç–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```
location /static/ {
    alias /app/static/;
}
```
–≥–¥–µ

    `location /static/` ‚Äî –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ –ø—É—Ç–∏ `/static/....`

    `alias /app/static/;` ‚Äî –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `/app/static/` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

        –ù–∞–ø—Ä–∏–º–µ—Ä, `http://localhost/static/style.css ‚Üí —Ñ–∞–π–ª /app/static/style.css.`


–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```
server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://app:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /images/ {
        alias /images/;
        autoindex on;
        access_log /var/log/nginx/images.log;  # Debug log
    }

    location /static/ {
        alias /app/static/;
    }
}
```
–ø–æ–º–æ–≥–∞–µ—Ç Nginx –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

| –ü—É—Ç—å       | –î–µ–π—Å—Ç–≤–∏–µ                                             |
| ---------- | ---------------------------------------------------- |
| `/`        | –ü—Ä–æ–∫—Å–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∞–¥—Ä–µ—Å—É `app:5000`            |
| `/images/` | –û—Ç–¥–∞—ë—Ç —Ñ–∞–π–ª—ã –∏–∑ `/images/`, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ |
| `/static/` | –û—Ç–¥–∞—ë—Ç —Ñ–∞–π–ª—ã –∏–∑ `/app/static/`                       |
